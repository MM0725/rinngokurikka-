<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>リンゴの木クリッカー - 動画背景版</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/addons/p5.sound.min.js"></script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
  }
  canvas {
    display: block;
  }
</style>
</head>

<body>
<script>

//========= ▼ 変数 =========
let bgVideo;
let treeImg, shopImg, appleImg;
let apples = [];
let money = 0;

//========= ▼ preload =========
function preload(){
  // ▼ 背景動画（mp4）
  bgVideo = createVideo("images/IMG_9114.mp4");
  bgVideo.hide();  // HTMLタグを非表示（p5描画のみ）

  // ▼ 画像
  treeImg = loadImage("images/tree.png");
  shopImg = loadImage("images/shop.png");
  appleImg = loadImage("images/apple.png");
}

//========= ▼ setup =========
function setup(){
  createCanvas(windowWidth, windowHeight);

  // ▼ 動画ループ
  bgVideo.loop();
  bgVideo.volume(0);

  // ▼ ブラウザ自動再生制限対応
  userStartVideo();
}

//========= ▼ draw =========
function draw(){
  background(0);

  // ==== 背景動画 ====
  if (bgVideo.loadedmetadata) {
    image(bgVideo, 0, 0, width, height);
  }

  // ==== 木 ====
  image(treeImg, width/2 - 150, height/2 - 200, 300, 300);

  // ==== 販売所 ====
  image(shopImg, 50, height - 180, 180, 160);

  // ==== リンゴ ====
  for (let a of apples){
    image(appleImg, a.x, a.y, a.size, a.size);
    a.y += a.speed;
  }

  // ==== 所持金 ====
  fill(255);
  textSize(30);
  text("所持金："+money+" 円", 20, 40);
}

//========= ▼ クリックでリンゴを落とす =========
function mousePressed(){
  apples.push({
    x: random(width/2 - 100, width/2 + 100),
    y: height/2 - 200,
    size: 40,
    speed: 3
  });
}

//========= ▼ 画面サイズ変動 =========
function windowResized(){
  resizeCanvas(windowWidth, windowHeight);
}

</script>
</body>
</html>
